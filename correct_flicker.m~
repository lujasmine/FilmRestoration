function corrected = correct_flicker(imgs, start_frame, end_frame)
    corrected = imgs;
    n_neighbours = 3;
    
    for img_num = start_frame:end_frame
        curr_frame = imgs(:,:,img_num);
        
        [avg_start, avg_end] = get_start_end_frames(img_num, ...
            start_frame, end_frame, n_neighbours);
        
        for r = 1 : size(imgs, 1)
           for col = 1 : size(imgs, 2)
               
               for n = avg_start : avg_end
               
               sum_pixels = sum(corrected(r,col,avg_start:avg_end),3);
               avg_pixels = sum_pixels / (avg_end - avg_start + 1);
               
               corrected(r,col,img_num) = avg_pixels;
           end
        end       
        
        % TODO change histeq
%         corrected(:,:,img_num) = histeq(corrected(:,:,img_num), imhist(frames_avg)); 
    end
end

function [start_frame, end_frame] = get_start_end_frames(curr, first, last, neighbours)
    start_frame = curr;
    end_frame = curr;

    if ((curr - neighbours) > first)
        start_frame = curr - neighbours;
    end

    if ((curr + neighbours) < last)
        end_frame = curr + neighbours;
    end
end